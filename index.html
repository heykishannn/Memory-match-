<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Memory Match Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes flipCard {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(180deg); }
        }
        
        @keyframes zoomOut {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(500px) rotate(360deg); opacity: 0; }
        }
        
        .card {
            transform-style: preserve-3d;
            transition: transform 0.5s;
            perspective: 1000px;
        }
        
        .card.flipped {
            transform: rotateY(180deg);
        }
        
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .card-back {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .card-front {
            background: linear-gradient(to bottom right, #ffffff, #f1f5f9);
            transform: rotateY(180deg);
            box-shadow: inset 0 0 0 2px rgba(0,0,0,0.1);
        }
        
        .popup {
            animation: zoomOut 0.3s ease-out;
        }
        
        .bounce {
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Celebration confetti */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
        }
        
        /* Custom gradient background */
        body {
            background: linear-gradient(to bottom right, #f6d365, #fda085);
            min-height: 100dvh;
        }
        
        /* Settings toggle button */
        .toggle-container {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-checkbox {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        .toggle-checkbox:checked + .toggle-slider {
            background-color: #4CAF50;
        }
        
        .toggle-checkbox:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        /* Responsive adjustments */
        @media (max-width: 640px) {
            .card {
                width: 60px;
                height: 60px;
            }
        }
        
        @media (min-width: 641px) and (max-width: 1023px) {
            .card {
                width: 80px;
                height: 80px;
            }
        }
        
        @media (min-width: 1024px) {
            .card {
                width: 100px;
                height: 100px;
            }
        }
    </style>
</head>
<body class="font-sans text-gray-800 overflow-x-hidden">
    <div class="container mx-auto px-4 py-6 flex flex-col min-h-dvh">
        <!-- Header Section -->
        <header class="text-center mb-6">
            <h1 class="text-4xl md:text-5xl font-bold text-orange-500 mb-2">Memory Match</h1>
            <div class="flex justify-between items-center px-4">
                <div id="levelDisplay" class="text-xl font-bold">Level: 1</div>
                <div id="scoreDisplay" class="text-xl font-bold text-green-600">Score: 0</div>
                <div id="timerDisplay" class="text-xl font-bold text-red-600">Time: 0s</div>
            </div>
            
            <div class="flex justify-center space-x-6 mt-4">
                <div class="flex items-center">
                    <span class="mr-2">Sound</span>
                    <label class="toggle-container">
                        <input type="checkbox" id="soundToggle" checked class="toggle-checkbox">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="flex items-center">
                    <span class="mr-2">Vibration</span>
                    <label class="toggle-container">
                        <input type="checkbox" id="vibrationToggle" checked class="toggle-checkbox">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
        </header>
        
        <!-- Game Board -->
        <main class="flex-grow flex items-center justify-center">
            <div id="gameBoard" class="w-full max-w-md mx-auto">
                <div id="cardContainer" class="grid grid-cols-4 gap-4 place-content-center"></div>
            </div>
            
            <!-- Win Popup -->
            <div id="winPopup" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
                <div class="popup bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl p-6 mx-4 shadow-2xl text-center max-w-sm w-full">
                    <h2 class="text-3xl font-bold text-white mb-4">Level Complete!</h2>
                    <p class="text-xl text-white mb-2">Score: <span id="finalScore" class="font-bold">0</span></p>
                    <p class="text-xl text-white mb-4">Time: <span id="finalTime" class="font-bold">0</span>s</p>
                    <p class="text-xl text-white mb-4">Level: <span id="finalLevel" class="font-bold">1</span></p>
                    <button id="nextLevelBtn" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-full text-xl transition duration-300 w-full mb-4">
                        Next Level
                    </button>
                    <p class="text-white text-sm">Keep going to unlock special content!</p>
                </div>
            </div>
            
            <!-- Game Over Popup -->
            <div id="gameOverPopup" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
                <div class="popup bg-gradient-to-br from-red-500 to-orange-500 rounded-2xl p-6 mx-4 shadow-2xl text-center max-w-sm w-full">
                    <h2 class="text-3xl font-bold text-white mb-4">Time's Up!</h2>
                    <p class="text-xl text-white mb-4">You made it to level <span id="failedLevel" class="font-bold">1</span>!</p>
                    <button id="restartBtn" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-full text-xl transition duration-300 w-full mb-4">
                        Start From Beginning
                    </button>
                    <button id="continueBtn" class="bg-white hover:bg-gray-100 text-orange-500 font-bold py-3 px-6 rounded-full text-xl transition duration-300 w-full">
                        Continue (Watch Ad)
                    </button>
                </div>
            </div>
            
            <!-- Start Screen -->
            <div id="startScreen" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
                <div class="popup bg-gradient-to-br from-blue-500 to-purple-500 rounded-2xl p-6 mx-4 shadow-2xl text-center max-w-sm w-full">
                    <h2 class="text-3xl font-bold text-white mb-4">Memory Match</h2>
                    <p class="text-xl text-white mb-6">Match all cards before time runs out!</p>
                    <div class="flex items-center justify-center mb-4">
                        <span class="mr-2 text-white">Sound</span>
                        <label class="toggle-container">
                            <input type="checkbox" id="startSoundToggle" checked class="toggle-checkbox">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="ml-4 mr-2 text-white">Vibration</span>
                        <label class="toggle-container">
                            <input type="checkbox" id="startVibrationToggle" checked class="toggle-checkbox">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <button id="newGameBtn" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-full text-xl transition duration-300 w-full mb-4">
                        New Game
                    </button>
                    <button id="continueGameBtn" class="bg-white hover:bg-gray-100 text-orange-500 font-bold py-3 px-6 rounded-full text-xl transition duration-300 w-full">
                        Continue
                    </button>
                </div>
            </div>

            <!-- Continue with Ad Popup -->
            <div id="continueAdPopup" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
                <div class="popup bg-gradient-to-br from-green-500 to-teal-500 rounded-2xl p-6 mx-4 shadow-2xl text-center max-w-sm w-full">
                    <h2 class="text-3xl font-bold text-white mb-4">Continue Game</h2>
                    <p class="text-xl text-white mb-6">Watch a short ad to continue your saved game!</p>
                    <div class="flex flex-col space-y-3">
                        <button id="watchAdBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-full text-xl transition duration-300 w-full">
                            Watch Ad to Continue
                        </button>
                        <button id="declineAdBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-full text-xl transition duration-300 w-full">
                            No Thanks, Start New Game
                        </button>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="text-center py-4 text-white">
            <p class="text-sm">Powered by NAS</p>
        </footer>
    </div>

    <!-- Sound Effects (hidden) -->
    <audio id="flipSound" src="https://assets.mixkit.co/sfx/preview/mixkit-quick-coin-collect-1939.mp3"></audio>
    <audio id="winSound" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>
    <audio id="loseSound" src="https://assets.mixkit.co/sfx/preview/mixkit-retro-arcade-lose-2027.mp3"></audio>
    <audio id="matchSound" src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3"></audio>
    <audio id="noMatchSound" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-explosion-1699.mp3"></audio>
    <audio id="celebrationSound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>

    <script>
        // Game Variables
        let currentLevel = 1;
        let score = 0;
        let timeLeft = 0;
        let initialTime = 0;
        let timer;
        let cards = [];
        let flippedCards = [];
        let matchedCards = [];
        let gameActive = false;
        let allowClicks = true;
        let soundEnabled = true;
        let vibrationEnabled = true;
        let firstFlipInLevel = true;
        
        // DOM Elements
        const cardContainer = document.getElementById('cardContainer');
        const levelDisplay = document.getElementById('levelDisplay');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const timerDisplay = document.getElementById('timerDisplay');
        const winPopup = document.getElementById('winPopup');
        const gameOverPopup = document.getElementById('gameOverPopup');
        const startScreen = document.getElementById('startScreen');
        const continueAdPopup = document.getElementById('continueAdPopup');
        const finalScore = document.getElementById('finalScore');
        const finalTime = document.getElementById('finalTime');
        const finalLevel = document.getElementById('finalLevel');
        const failedLevel = document.getElementById('failedLevel');
        const nextLevelBtn = document.getElementById('nextLevelBtn');
        const restartBtn = document.getElementById('restartBtn');
        const continueBtn = document.getElementById('continueBtn');
        const newGameBtn = document.getElementById('newGameBtn');
        const continueGameBtn = document.getElementById('continueGameBtn');
        const watchAdBtn = document.getElementById('watchAdBtn');
        const declineAdBtn = document.getElementById('declineAdBtn');
        const soundToggle = document.getElementById('soundToggle');
        const vibrationToggle = document.getElementById('vibrationToggle');
        const startSoundToggle = document.getElementById('startSoundToggle');
        const startVibrationToggle = document.getElementById('startVibrationToggle');
        
        // Sound Elements
        const flipSound = document.getElementById('flipSound');
        const winSound = document.getElementById('winSound');
        const loseSound = document.getElementById('loseSound');
        const matchSound = document.getElementById('matchSound');
        const noMatchSound = document.getElementById('noMatchSound');
        const celebrationSound = document.getElementById('celebrationSound');
        
        // Emoji symbols for cards (expanded to 100 unique emojis)
        const emojis = [
            '🍎', '🍌', '🍒', '🍓', '🍊', '🍋', '🍍', '🥝', '🥥', '🍇', 
            '🍉', '🍈', '🍑', '🍏', '🥭', '🥑', '🍆', '🥕', '🌽', '🥦', 
            '🥬', '🥒', '🍄', '🧄', '🧅', '🥔', '🍕', '🍔', '🍟', '🌭', 
            '🥪', '🍖', '🍗', '🥩', '🍤', '🍩', '🍪', '🎂', '🍰', '🧁', 
            '🍫', '🍬', '🍭', '🍮', '🍯', '☕', '🍵', '🥤', '🍺', '🍷',
            '⚽', '🏀', '🏈', '⚾', '🥎', '🎾', '🏐', '🏉', '🎱', '🏓',
            '🏸', '🏒', '🏑', '🥍', '🏏', '🪃', '🥅', '⛳', '🪁', '🏹',
            '🎣', '🤿', '🥊', '🥋', '🎽', '🛹', '🛼', '🛷', '⛸️', '🥌',
            '🎲', '♟️', '🀄', '🎯', '🎳', '🎮', '🎰', '🚗', '🚕', '🚙',
            '🚌', '🚎', '🏎️', '🚓', '🚑', '🚒', '🚐', '🛻', '🚚', '🚛'
        ];
        
        // Initialize the game
        function initGame() {
            // Load saved settings
            const savedSettings = localStorage.getItem('memoryMatchSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                soundEnabled = settings.soundEnabled !== false;
                vibrationEnabled = settings.vibrationEnabled !== false;
                
                // Update toggle buttons
                soundToggle.checked = soundEnabled;
                vibrationToggle.checked = vibrationEnabled;
                startSoundToggle.checked = soundEnabled;
                startVibrationToggle.checked = vibrationEnabled;
            }
            
            // Load saved game if exists
            const savedGame = localStorage.getItem('memoryMatchGame');
            if (savedGame) {
                const gameData = JSON.parse(savedGame);
                currentLevel = gameData.level || 1;
                score = gameData.score || 0;
                
                // Update display with loaded data
                levelDisplay.textContent = `Level: ${currentLevel}`;
                scoreDisplay.textContent = `Score: ${score}`;
            }
            
            // Set up event listeners
            nextLevelBtn.addEventListener('click', nextLevel);
            restartBtn.addEventListener('click', startNewGame);
            continueBtn.addEventListener('click', continueWithAd);
            newGameBtn.addEventListener('click', startNewGame);
            continueGameBtn.addEventListener('click', handleContinueGame);
            watchAdBtn.addEventListener('click', watchAdToContinue);
            declineAdBtn.addEventListener('click', declineAdAndStartNew);
            
            // Sound toggle events
            soundToggle.addEventListener('change', function(e) {
                soundEnabled = e.target.checked;
                setAllSoundsVolume(soundEnabled ? 1 : 0);
                startSoundToggle.checked = soundEnabled;
                saveSettings();
            });
            
            vibrationToggle.addEventListener('change', function(e) {
                vibrationEnabled = e.target.checked;
                startVibrationToggle.checked = vibrationEnabled;
                saveSettings();
            });
            
            startSoundToggle.addEventListener('change', function(e) {
                soundEnabled = e.target.checked;
                setAllSoundsVolume(soundEnabled ? 1 : 0);
                soundToggle.checked = soundEnabled;
                saveSettings();
            });
            
            startVibrationToggle.addEventListener('change', function(e) {
                vibrationEnabled = e.target.checked;
                vibrationToggle.checked = vibrationEnabled;
                saveSettings();
            });
            
            // Initialize sound settings
            setAllSoundsVolume(soundEnabled ? 1 : 0);
            
            // Show start screen
            startScreen.classList.remove('hidden');
        }
        
        // Handle continue game with ad option
        function handleContinueGame() {
            startScreen.classList.add('hidden');
            const savedGame = localStorage.getItem('memoryMatchGame');
            
            if (savedGame) {
                // Show ad popup before continuing
                continueAdPopup.classList.remove('hidden');
            } else {
                // No saved game, force new game
                startNewGame();
            }
        }
        
        // Watch ad to continue saved game
        function watchAdToContinue() {
            // Placeholder for AdMob rewarded ad
            console.log('Showing rewarded ad with ID: ca-app-pub-6948714269796627/6982752841');
            
            // For testing purposes, just continue after "watching" ad
            continueAdPopup.classList.add('hidden');
            firstFlipInLevel = true;
            setupLevel(currentLevel);
            
            // Play ad completion sound
            if (soundEnabled) {
                winSound.currentTime = 0;
                winSound.play();
            }
        }
        
        // Decline ad and start new game
        function declineAdAndStartNew() {
            continueAdPopup.classList.add('hidden');
            startNewGame();
        }
        
        // Set volume for all sounds
        function setAllSoundsVolume(volume) {
            flipSound.volume = volume;
            winSound.volume = volume;
            loseSound.volume = volume;
            matchSound.volume = volume;
            noMatchSound.volume = volume;
            celebrationSound.volume = volume;
        }
        
        // Save settings to localStorage
        function saveSettings() {
            const settings = {
                soundEnabled: soundEnabled,
                vibrationEnabled: vibrationEnabled
            };
            localStorage.setItem('memoryMatchSettings', JSON.stringify(settings));
        }
        
        // Start a new game
        function startNewGame() {
            currentLevel = 1;
            score = 0;
            firstFlipInLevel = true;
            startScreen.classList.add('hidden');
            continueAdPopup.classList.add('hidden');
            setupLevel(currentLevel);
        }
        
        // Continue with rewarded ad
        function continueWithAd() {
            // Placeholder for Admob rewarded ad
            console.log('Showing rewarded ad with ID: ca-app-pub-6948714269796627/6982752841');
            
            // For testing purposes, just continue
            gameOverPopup.classList.add('hidden');
            setupLevel(currentLevel);
            
            // Give extra time based on difficulty
            const pairs = Math.min(2 + Math.floor(currentLevel / 2), 50);
            timeLeft = calculateTimeForPairs(pairs) / 2; // Half of normal time
            updateTimerDisplay();
            startTimer();
        }
        
        // Calculate time based on number of pairs
        function calculateTimeForPairs(pairs) {
            // Base time + extra time based on pairs
            const baseTime = 30; // Minimum time for easiest level
            const extraTimePerPair = 3; // Additional seconds per pair
            
            // More difficult levels get progressively more time
            return Math.floor(baseTime + (pairs * extraTimePerPair) + (currentLevel * 0.5));
        }
        
        // Set up a level
        function setupLevel(level) {
            // Reset game state
            clearInterval(timer);
            cards = [];
            flippedCards = [];
            matchedCards = [];
            gameActive = true;
            allowClicks = true;
            firstFlipInLevel = true;
            
            // Clear previous cards
            cardContainer.innerHTML = '';
            
            // Calculate cards needed based on level (minimum 4 cards, 2 pairs)
            const pairs = Math.min(2 + Math.floor(level / 2), 50); // Max 50 pairs (100 cards)
            const totalCards = pairs * 2;
            
            // Calculate initial time based on difficulty
            initialTime = calculateTimeForPairs(pairs);
            timeLeft = 0; // Timer will start on first flip
            updateTimerDisplay();
            
            // Update UI
            levelDisplay.textContent = `Level: ${level}`;
            scoreDisplay.textContent = `Score: ${score}`;
            timerDisplay.classList.remove('font-bold', 'animate-pulse');
            
            // Select random emojis for this level
            const shuffledEmojis = shuffleArray([...emojis]).slice(0, pairs);
            let cardValues = [];
            
            // Create pairs for each selected emoji
            shuffledEmojis.forEach(emoji => {
                cardValues.push(emoji, emoji);
            });
            
            // Shuffle the cards
            const shuffledCards = shuffleArray(cardValues);
            
            // Calculate grid columns based on totalCards to maintain square layout
            const gridCols = Math.ceil(Math.sqrt(totalCards));
            cardContainer.className = `grid gap-4 place-content-center`;
            cardContainer.style.gridTemplateColumns = `repeat(${gridCols}, minmax(0, 1fr))`;
            
            // Create and display cards
            shuffledCards.forEach((emoji, index) => {
                const card = document.createElement('div');
                card.className = 'card cursor-pointer relative';
                card.dataset.index = index;
                card.dataset.value = emoji;
                
                const cardBack = document.createElement('div');
                cardBack.className = 'card-back card-face';
                
                const cardFront = document.createElement('div');
                cardFront.className = 'card-front card-face text-4xl';
                cardFront.textContent = emoji;
                
                card.appendChild(cardBack);
                card.appendChild(cardFront);
                
                card.addEventListener('click', () => flipCard(card));
                cardContainer.appendChild(card);
                
                cards.push({
                    element: card,
                    value: emoji,
                    flipped: false,
                    matched: false
                });
            });
        }
        
        // Shuffle array
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        // Flip a card
        function flipCard(cardElement) {
            if (!gameActive || !allowClicks) return;
            
            const index = parseInt(cardElement.dataset.index);
            const card = cards[index];
            
            // Don't allow flipping if already flipped or matched
            if (card.flipped || card.matched || flippedCards.length >= 2) return;
            
            // Start timer on first flip of the level
            if (firstFlipInLevel) {
                timeLeft = initialTime;
                updateTimerDisplay();
                startTimer();
                firstFlipInLevel = false;
            }
            
            // Play flip sound
            if (soundEnabled) {
                flipSound.currentTime = 0;
                flipSound.play();
            }
            
            if (vibrationEnabled && 'vibrate' in navigator) {
                navigator.vibrate(20); // Short vibration on flip
            }
            
            // Flip the card
            card.flipped = true;
            cardElement.classList.add('flipped');
            flippedCards.push(card);
            
            // Check for match when two cards are flipped
            if (flippedCards.length === 2) {
                checkForMatch();
            }
        }
        
        // Update timer display
        function updateTimerDisplay() {
            timerDisplay.textContent = `Time: ${timeLeft}s`;
        }
        
        // Check for matching cards
        function checkForMatch() {
            const [card1, card2] = flippedCards;
            
            if (card1.value === card2.value) {
                // Match found
                if (soundEnabled) {
                    matchSound.currentTime = 0;
                    matchSound.play();
                }
                
                if (vibrationEnabled && 'vibrate' in navigator) {
                    navigator.vibrate(100); // Success vibration
                }
                
                // Mark as matched
                card1.matched = true;
                card2.matched = true;
                matchedCards.push(card1, card2);
                
                // Add points to score (more points for quicker matches)
                const timeBonus = Math.max(5, 15 - Math.floor((initialTime - timeLeft) / 5));
                const points = timeBonus * currentLevel;
                score += points;
                scoreDisplay.textContent = `Score: ${score}`;
                
                // Clear flipped cards
                flippedCards = [];
                
                // Check for win
                if (matchedCards.length === cards.length) {
                    levelComplete();
                }
            } else {
                // No match
                allowClicks = false;
                if (soundEnabled) {
                    noMatchSound.currentTime = 0;
                    noMatchSound.play();
                }
                
                if (vibrationEnabled && 'vibrate' in navigator) {
                    navigator.vibrate(200); // Longer vibration for wrong match
                }
                
                // Flip back after delay
                setTimeout(() => {
                    card1.flipped = false;
                    card2.flipped = false;
                    card1.element.classList.remove('flipped');
                    card2.element.classList.remove('flipped');
                    flippedCards = [];
                    allowClicks = true;
                }, 1000);
            }
        }
        
        // Start the timer
        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 10) {
                    timerDisplay.classList.add('font-bold', 'animate-pulse');
                    
                    // Play ticking sound when time is running out
                    if (soundEnabled && timeLeft <= 5 && timeLeft > 0) {
                        flipSound.currentTime = 0;
                        flipSound.play();
                    }
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    gameOver();
                }
            }, 1000);
        }
        
        // Level complete
        function levelComplete() {
            gameActive = false;
            clearInterval(timer);
            
            // Play win sound and vibrate
            if (soundEnabled) {
                celebrationSound.currentTime = 0;
                celebrationSound.play();
                winSound.currentTime = 0;
                winSound.play();
            }
            
            if (vibrationEnabled && 'vibrate' in navigator) {
                navigator.vibrate([200, 100, 200]);
            }
            
            // Create celebration confetti
            createConfetti();
            
            // Show win popup
            finalScore.textContent = score;
            finalTime.textContent = initialTime - timeLeft;
            finalLevel.textContent = currentLevel;
            winPopup.classList.remove('hidden');
            
            // Save game progress
            saveGame();
        }
        
        // Create celebration confetti
        function createConfetti() {
            if (!soundEnabled) return;
            
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.top = '-10px';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animation = `confetti ${Math.random() * 3 + 2}s linear forwards`;
                confetti.style.opacity = '1';
                
                document.body.appendChild(confetti);
                
                // Remove confetti after animation
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }
        
        // Game over
        function gameOver() {
            gameActive = false;
            clearInterval(timer);
            
            // Play lose sound and vibrate
            if (soundEnabled) {
                loseSound.currentTime = 0;
                loseSound.play();
            }
            
            if (vibrationEnabled && 'vibrate' in navigator) {
                navigator.vibrate(500);
            }
            
            // Show game over popup
            failedLevel.textContent = currentLevel;
            gameOverPopup.classList.remove('hidden');
        }
        
        // Next level
        function nextLevel() {
            currentLevel++;
            if (currentLevel > 100) {
                // Celebration for completing all levels
                currentLevel = 1;
                score = 0;
                // Show special congratulations message
                alert('Congratulations! You completed all 100 levels! Starting over now.');
            }
            
            winPopup.classList.add('hidden');
            firstFlipInLevel = true;
            setupLevel(currentLevel);
        }
        
        // Save game state
        function saveGame() {
            const gameData = {
                level: currentLevel,
                score: score
            };
            localStorage.setItem('memoryMatchGame', JSON.stringify(gameData));
        }
        
        // Initialize the game when page loads
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
<p style="border-radius: 8px; text-align: center; font-size: 12px; color: #fff; margin-top: 16px;position: fixed; left: 8px; bottom: 8px; z-index: 10; background: rgba(0, 0, 0, 0.8); padding: 4px 8px;">Made with <img src="https://enzostvs-deepsite.hf.space/logo.svg" alt="DeepSite Logo" style="width: 16px; height: 16px; vertical-align: middle;display:inline-block;margin-right:3px;filter:brightness(0) invert(1);"><a href="https://enzostvs-deepsite.hf.space" style="color: #fff;text-decoration: underline;" target="_blank" >DeepSite</a> - 🧬 <a href="https://enzostvs-deepsite.hf.space?remix=Heykishan/memory-match" style="color: #fff;text-decoration: underline;" target="_blank" >Remix</a></p></body>
</html>